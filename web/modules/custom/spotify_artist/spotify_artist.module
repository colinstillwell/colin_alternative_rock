<?php

/**
 * @file
 * Contains hook implementations for the Spotify Artist module.
 */

/**
 * Implements hook_preprocess_HOOK() for spotify_artist templates.
 */
function spotify_artist_preprocess_spotify_artist(array &$variables): void {
  /** @var \Drupal\spotify_artist\Entity\SpotifyArtist $entity */
  $entity = $variables['elements']['#spotify_artist'];

  // Prepare template variables.
  $variables['artist_name'] = $entity->getArtistName();
  $variables['artist_genres'] = [
    '#theme' => 'item_list',
    '#items' => $entity->getArtistGenres(),
    '#title' => t('Genres'),
  ];
  $variables['artist_followers'] = [
    '#type' => 'inline_template',
    '#template' => '<strong>{{ label }}</strong> {{ count }}',
    '#context' => [
      'label' => t('Followers:'),
      'count' => number_format($entity->getArtistFollowers()),
    ],
  ];
  $variables['artist_popularity'] = [
    '#type' => 'inline_template',
    '#template' => '<strong>{{ label }}</strong> {{ value }} / 100',
    '#context' => [
      'label' => t('Popularity:'),
      'value' => $entity->getArtistPopularity(),
    ],
  ];
  $variables['artist_image'] = [
    '#theme' => 'imagecache_external',
    '#uri' => $entity->getArtistImage(),
    '#style_name' => 'spotify_artist_160',
    '#alt' => $entity->getArtistName(),
  ];
  $variables['artist_link'] = [
    '#type' => 'inline_template',
    '#template' => '<a href="{{ url }}" target="_blank" rel="noopener noreferrer">{{ label }}</a>',
    '#context' => [
      'url' => $entity->getSpotifyUrl(),
      'label' => t('View on Spotify'),
    ],
  ];

  // Attach libraries.
  $variables['#attached']['library'][] = 'spotify_artist/spotify_artist';
}
